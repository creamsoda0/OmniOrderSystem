# product-deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: product-service-deployment
  labels:
    app: product-service
spec:
  replicas: 2 # ì¥ì•  ëŒ€ë¹„ ë° ë¶€í•˜ ë¶„ì‚°ì„ ìœ„í•´ 2ê°œë¡œ ì„¤ì •
  selector:
    matchLabels:
      app: product-service
  template:
    metadata:
      labels:
        app: product-service
    spec:
      containers:
        - name: product-service-container
          # ğŸ³ Docker Hubì— í‘¸ì‹œí•œ ì´ë¯¸ì§€ ì´ë¦„ìœ¼ë¡œ ë³€ê²½
          image: creamdocker/product-service:1.0.0
          ports:
            - containerPort: 8082 # Product Serviceê°€ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
          env:
            # ğŸ’¡ ì¤‘ìš”: Eureka ì„œë²„ ì£¼ì†Œë¥¼ Service ì´ë¦„ìœ¼ë¡œ ì§€ì •
            - name: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
              value: http://eureka-service:8761/eureka/
            # ğŸ’¡ Redis ì—°ê²° ì„¤ì • ì¶”ê°€
            - name: SPRING_REDIS_HOST
              value: redis-service # Redis Serviceì˜ DNS ì´ë¦„
            - name: SPRING_REDIS_PORT
              value: "6379"

            # ğŸ’¡ DB ì—°ê²° ì„¤ì • ì¶”ê°€
            - name: SPRING_DATASOURCE_URL
              value: jdbc:postgresql://postgres-service:5432/omniorderdb
            - name: SPRING_DATASOURCE_USERNAME
              value: user
            - name: SPRING_DATASOURCE_PASSWORD
              value: password
---
apiVersion: v1
kind: Service
metadata:
  name: product-service # Order Serviceê°€ ì´ ì´ë¦„ìœ¼ë¡œ Product Serviceë¥¼ ì°¾ìŒ
spec:
  selector:
    app: product-service
  ports:
    - port: 8082
      targetPort: 8082
      # NodePort íƒ€ì…ìœ¼ë¡œ ì„¤ì •í•˜ë©´ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ Node IPì™€ í¬íŠ¸ë¡œ ì ‘ê·¼ ê°€ëŠ¥ (í…ŒìŠ¤íŠ¸ ëª©ì )
  type: ClusterIP