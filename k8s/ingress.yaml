apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: omniorder-ingress
  annotations:
    # ğŸ’¡ Nginx Ingress Controllerë¥¼ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
    # ë§Œì•½ ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì—¬ê¸°ì— í•´ë‹¹í•˜ëŠ” annotationì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
    # ì˜ˆì‹œ: Ingressê°€ ìš”ì²­ì„ Serviceì˜ ë£¨íŠ¸ ê²½ë¡œ('/')ë¡œ ì „ë‹¬í•˜ë„ë¡ ì„¤ì •
    nginx.ingress.kubernetes.io/rewrite-target: /$1
spec:
  # ğŸ’¡ Ingressì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•  Host ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
  # ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” 'localhost'ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ /etc/hosts íŒŒì¼ì„ ìˆ˜ì •í•˜ê±°ë‚˜,
  # hostë¥¼ ìƒëµí•˜ê³  Minikube IPë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ë„ë©”ì¸ ì„¤ì •ì„ ìƒëµí•©ë‹ˆë‹¤.
  # rules:
  #   - host: "api.myshop.com"

  rules:
    - http:
        paths:
          # 1. Order Service ê²½ë¡œ ì„¤ì •
          - path: /orders
            pathType: Prefix # /ordersë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ ì²˜ë¦¬
            backend:
              service:
                name: order-service
                port:
                  number: 8081 # Order Serviceì˜ ë‚´ë¶€ í¬íŠ¸

          # 2. Product Service ê²½ë¡œ ì„¤ì • (ì¬ê³  ì¡°íšŒ ë“±)
          - path: /products
            pathType: Prefix # /productsë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ ì²˜ë¦¬
            backend:
              service:
                name: product-service
                port:
                  number: 8082 # Product Serviceì˜ ë‚´ë¶€ í¬íŠ¸

          # 3. Eureka Dashboard (ì˜µì…˜: ê´€ë¦¬ë¥¼ ìœ„í•´ /eureka ê²½ë¡œë¥¼ ì—°ê²°)
          - path: /eureka
            pathType: Prefix
            backend:
              service:
                name: eureka-service
                port:
                  number: 8761 # Eureka Serviceì˜ ë‚´ë¶€ í¬íŠ¸

          # 4. í”„ë¡ íŠ¸ì—”ë“œ/ì›¹ í˜ì´ì§€ ì œê³µ (Order Serviceê°€ ì •ì  íŒŒì¼ì„ ì œê³µí•œë‹¤ê³  ê°€ì •)
          # Order Serviceê°€ index.htmlì„ ì„œë¹™í•˜ë¯€ë¡œ, ë£¨íŠ¸ ê²½ë¡œëŠ” Order Serviceë¡œ ë³´ëƒ…ë‹ˆë‹¤.
          - path: /
            pathType: Prefix
            backend:
              service:
                name: order-service
                port:
                  number: 8081