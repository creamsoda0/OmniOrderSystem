# order-deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service-deployment
  labels:
    app: order-service
spec:
  replicas: 2
  selector:
    matchLabels:
      app: order-service
  template:
    metadata:
      labels:
        app: order-service
    spec:
      containers:
        - name: order-service-container
          # ğŸ³ Docker Hubì— í‘¸ì‹œí•œ ì´ë¯¸ì§€ ì´ë¦„ìœ¼ë¡œ ë³€ê²½
          image: creamdocker/order-service:1.0.0
          ports:
            - containerPort: 8081 # Order Serviceê°€ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
          env:
            # ğŸ’¡ ì¤‘ìš”: Eureka ì„œë²„ ì£¼ì†Œë¥¼ Service ì´ë¦„ìœ¼ë¡œ ì§€ì •
            - name: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
              value: http://eureka-service:8761/eureka/
            # ğŸ’¡ Redis ì—°ê²° ì„¤ì • ì¶”ê°€
            - name: SPRING_REDIS_HOST
              value: redis-service # Redis Serviceì˜ DNS ì´ë¦„
            - name: SPRING_REDIS_PORT
              value: "6379"

            # ğŸ’¡ DB ì—°ê²° ì„¤ì • ì¶”ê°€
            - name: SPRING_DATASOURCE_URL
              value: jdbc:postgresql://postgres-service:5432/omniorderdb
            - name: SPRING_DATASOURCE_USERNAME
              value: postgres
            - name: SPRING_DATASOURCE_PASSWORD
              value: "1234"

---
apiVersion: v1
kind: Service
metadata:
  name: order-service # ì™¸ë¶€ ì ‘ê·¼ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì´ë¦„
spec:
  selector:
    app: order-service
  ports:
    - port: 8081
      targetPort: 8081
      # NodePort íƒ€ì…ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
      nodePort: 30081 # ì™¸ë¶€ì— ë…¸ì¶œë  í¬íŠ¸ (30000-32767 ë²”ìœ„)
  type: NodePort