apiVersion: skaffold/v2beta29
kind: Config
metadata:
  name: omni-order-project

# 1. 빌드 설정
build:
  # 태그 정책: 로컬 개발 시에는 git 대신 sha256을 쓰거나 기본값을 쓰는 게 정신건강에 좋습니다.
  # 여기서는 기본 로컬 개발 설정을 따르도록 명시적인 tagPolicy를 제거하거나 간단히 둡니다.
  local:
    push: false # 로컬 쿠버네티스(Docker Desktop/Minikube) 사용 시 이미지를 레지스트리에 푸시하지 않음

  artifacts:
    # Order Service
    - image: creamdocker/order-service
      context: ../order-service # skaffold.yaml이 있는 폴더의 상위(../)로 가서 찾음
      docker:
        dockerfile: Dockerfile

    # Product Service
    - image: creamdocker/product-service
      context: ../product-service
      docker:
        dockerfile: Dockerfile

# 2. 배포 설정
deploy:
  kubectl:
    manifests:
    - "*-deployment.yaml"  # ~deployment.yaml로 끝나는 파일만
    - "ingress.yaml"       # 인그레스 파일

      # 만약 특정 파일만 포함해야 한다면 아래처럼 적되, 경로가 정확해야 합니다.
      # - database-deployment.yaml
      # - eureka-deployment.yaml